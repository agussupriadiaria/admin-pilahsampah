-- 1. Masukkan data match ke transactions_success
INSERT INTO transactions_success (transactionid, transactiondate, transactioncode, amount, status)
SELECT transactionid, transactiondate, transactioncode, amount, 'Success'
FROM transactions t
WHERE EXISTS (
	SELECT 1
	FROM savedatabaru s
	WHERE s.transactioncode = t.transactioncode
	AND s.date = t.transactiondate
);

-- 2. Hapus data match dari savedatabaru
DELETE FROM savedatabaru
WHERE EXISTS (
	SELECT 1
	FROM transactions t
	WHERE savedatabaru.transactioncode = t.transactioncode
	AND savedatabaru.date = t.transactiondate
);

-- 3. Hapus data match dari transactions
DELETE FROM transactions
WHERE EXISTS (
	SELECT 1
	FROM savedatabaru s
	WHERE s.transactioncode = transactions.transactioncode
	AND s.date = transactions.transactiondate
);

-- 4. Masukkan data tidak match ke transactions_invalid
INSERT INTO transactions_invalid (transactionid, transactiondate, transactioncode, amount, status)
SELECT transactionid, transactiondate, transactioncode, amount, 'Invalid'
FROM transactions;

-- 5. Hapus semua data tersisa di transactions
DELETE FROM transactions;
